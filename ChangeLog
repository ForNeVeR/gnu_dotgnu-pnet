
2002-05-11  Rhys Weatherley  <rweather@southern-storm.com.au>

	* libffi/*: remove all libffi source files, prior to upgrade.

2002-05-10  Rhys Weatherley  <rweather@southern-storm.com.au>

	* ilalink/link_create.c: don't report "unresolved type reference"
	for synthetic types and synthetic uses of "System.Array".

	* codegen/cg_stmt.tc, codegen/jv_stmt.tc (ILNode_If): do not
	generate branch instructions at the end of a "then" clause if
	it ends with a "return" statement, because it will cause incorrect
	code generation if the "else" clause also ends with a "return".

	* codegen/cg_logical.tc, codegen/jv_logical.tc (ILNode_LogicalNot):
	reversed test in "GenValue".

	* cscc/csdoc.c, cscc/common/cc_main.c, cscc/common/cc_main.h:
	turn on doc comments when compiling C# code with "csdoc".

	* cscc/csdoc.c: bug fixes to XML output for interfaces and
	constructors.

	* cscc/csdoc.c: do not output "System.Object" as a base type
	in the C# signature, because it looks odd.

2002-05-09  Rhys Weatherley  <rweather@southern-storm.com.au>

	* libgc/misc.c: fix a Win32-ism that is affecting builds on
	some Cygwin systems.

	* codegen/cg_library.c, codegen/cg_lvalue.tc, codegen/cg_misc.tc,
	codegen/cg_output.c, codegen/jv_lvalue.tc, codegen/jv_misc.tc:
	continue implementation of method invocation for value types.

	* codegen/cg_misc.tc, codegen/cg_nodes.tc, codegen/jv_misc.tc,
	cscc/csharp/cs_invoke.tc, cscc/csharp/cs_lvalue.tc: box managed
	values that are passed to ordinary class methods as "this".

	* engine/lib_enum.c (_IL_Enum_GetEnumName): wrong pointer used
	to fetch the field name.

	* engine/mkint.sh, engine/HACKING: add the "mkint.sh" script
	to the CVS repository.

	* cscc/cscc.1, cscc/cscc.c, doc/pnettools.texi: add the "-fsave-asm"
	option to the compiler to assist with debugging.

2002-05-08  Rhys Weatherley  <rweather@southern-storm.com.au>

	* codegen/cg_gen.c, codegen/cg_misc.tc, codegen/cg_nodes.tc,
	codegen/cg_output.c, codegen/cg_output.h, cscc/csharp/cs_decls.tc,
	cscc/csharp/cs_gather.c, cscc/csharp/cs_grammar.y,
	cscc/csharp/cs_invoke.tc: complete the implementation of the
	"__arglist" keyword in the compiler.

	* codegen/cg_lvalue.tc (ILNode_MemberField): bug fixes to field
	accesses within managed values - previously the code was assuming
	that everything was an object reference.

	* codegen/cg_resolve.c: use the current class as the default
	call scope when resolving operators.

	* codegen/cg_resolve.c (ResolveMethod): off by one when checking
	if all arguments were coercable; continue resolving if member is
	inaccessible.

	* codegen/cg_nodes.tc, cscc/csharp/cs_grammar.y,
	cscc/csharp/cs_stmt.tc: implement semantic analysis for the simple
	array case of the "foreach" statement.

	* codegen/cg_misc.tc, codegen/jv_misc.tc, cscc/csharp/cs_lvalue.tc:
	improve method invocation handling for value types.

2002-05-07  Rhys Weatherley  <rweather@southern-storm.com.au>

	* codegen/cg_library.c, codegen/cg_misc.tc, codegen/cg_nodes.tc,
	codegen/jv_misc.tc, cscc/csharp/cs_grammar.y, cscc/csharp/cs_misc.tc,
	cscc/csharp/cs_scanner.l: implement the "__makeref", "__reftype",
	and "__refvalue" operators.

	* doc/pnettools.texi: document the new compiler keywords.

2002-05-06  Rhys Weatherley  <rweather@southern-storm.com.au>

	* codegen/cg_scope.c, codegen/cg_scope.h, cscc/csharp/Makefile.am,
	cscc/csharp/cs_attrs.c, cscc/csharp/cs_internal.h: begin adding
	support for attribute semantic analysis.

	* codegen/cg_misc.tc, codegen/cg_nodes.tc, codegen/jv_misc.tc,
	cscc/csharp/cs_decls.tc, cscc/csharp/cs_grammar.y,
	cscc/csharp/cs_internal.h, cscc/csharp/cs_invoke.tc:
	implement non-static field initializers.

	* codegen/cg_lvalue.tc, codegen/cg_nodes.tc, codegen/cg_utils.c,
	codegen/cg_utils.h, codegen/jv_lvalue.tc, cscc/csharp/cs_lvalue.tc:
	implement code generation for "ref" and "out" argument variables.

	* engine/engine.h, engine/int_proto.h, engine/int_table.c,
	engine/lib_misc.c, engine/process.c, engine/verify_obj.c,
	samples/mscorlib.dll: implement internalcall's for "ArgIterator"
	and "TypedReference.ToObject"; bug fix to verification of "arglist";
	update "mscorlib.dll" with new declaration of "ArgIterator.End".

	* codegen/cg_gen.c, codegen/cg_gen.h, codegen/cg_library.c,
	codegen/cg_misc.tc, codegen/cg_nodes.tc, codegen/jv_misc.tc,
	cscc/csharp/cs_grammar.y, cscc/csharp/cs_invoke.tc,
	cscc/csharp/cs_scanner.l: begin adding support for the "__arglist"
	keyword in the compiler.

2002-05-05  Rhys Weatherley  <rweather@southern-storm.com.au>

	* engine/call.c, engine/cvm_call.c, engine/engine.h,
	engine/ilrun.1, engine/ilrun.c, engine/process.c: adjust for
	pnet coding guidelines; make the -S option kbytes to be consistent
	with -H; document -S in the manpage.

	* engine/lib_diag.c (_IL_StackFrame_GetExceptionStackTrace):
	perform manual allocation of the stack frame array to stop the
	engine being recursively re-entered on StackOverflowException;
	limit the number of reported frames to 256.

2002-05-04  Jonathan Springer <jonathan.springer@verizon.net>

	* engine/call.c, engine/cvm_call.c, engine/engine.h:
	implement dynamic reallocations of frame stack (and add some stack
	overflow exceptions where they were TODOs).

	* engine/call.c:  Use _ILSystemException to provide
	StackOverflowException information from CallMethod and CallMethodV.

	* enigine/ilrun.c, engine/process.c, include/il_engine.h:
	Add '--stack-size' and '-S' command-line arguments to allow override
	of default stack size (8K).

2002-05-05  Rhys Weatherley  <rweather@southern-storm.com.au>

	* csdoc/doc_valil.c (AttributeToName): length-determination error
	that caused SEGV's when converting attributes.

	* codegen/cg_stmt.tc (EndsInReturn): recognise ILNode_LineInfo
	nodes when checking for "return" statements.

	* engine/cvm.c, engine/cvm_except.c, engine/engine.h,
	samples/except.cs: insert stack traces into exception objects
	that are created by the engine; expose "SystemException" as
	"_ILSystemException" so it can be reused elsewhere.

	* ildiff/.cvsignore: add .cvsignore file to ildiff directory.

2002-05-04  Rhys Weatherley  <rweather@southern-storm.com.au>

	* cscc/csharp/cs_grammar.y (OuterDeclaration): don't call "yyerrok"
	if we have reached EOF, because it will cause the parser to loop
	indefinitely when an error is detected at the outermost level.

	* engine/Makefile.am, engine/int_proto.h, engine/int_table.c,
	engine/lib_emit.c, engine/lib_reflect.c, samples/System.dll,
	samples/mscorlib.dll: update pnetlib and stub the extra internalcall's
	that "Reflection.Emit" requires.

	* engine/ilverify.c: resolve assembly references when verifying
	an IL application.

	* codegen/cg_stmt.tc (EndsInReturn): recognise ILNode_ThrowExpr
	as a "return" statement.

	* cscc/csharp/cs_grammar.y: wrap blocks and for/foreach statements
	in "ILNode_NewScope" nodes to perform correct variable scoping.

	* support/socket.c: use "sizeof(struct sockaddr_in)" instead of
	"sizeof(struct sockaddr)".

	* engine/int_proto.h, engine/int_table.c, engine/lib_socket.c,
	support/socket.c: make the IP addresses consistently network
	byte order in all relevant places; implement conversions between
	host and network byte order.

	* samples/System.dll, samples/System.Xml.dll: updated assemblies.

2002-05-03  Rhys Weatherley  <rweather@southern-storm.com.au>

	* engine/HACKING: update the section on "internalcall" methods.

2002-05-02  Rhys Weatherley  <rweather@southern-storm.com.au>

	* image/ser_parse.c (ILSerializeReaderGetExtra): reversed the parse
	order of an extra field's name and type.

	* image/Makefile.am, image/item.c, image/lib_attrs.c,
	include/il_program.h, include/il_system.h, support/allocate.c:
	implement routines to convert C# attribute values into metadata
	for builtins like "MethodImpl", "DllImport", "MarshalAs", etc.

2002-05-01  Rhys Weatherley  <rweather@southern-storm.com.au>

	* support/spawn.c: report signals from spawned child processes.

	* codegen/cg_optable.c: do not insert primitive type coercions
	into the result of an operator, as the type is already final.

	* image/pecoff_writer.c (ILWriterTextWrite): bug fix for blocks
	that are greater than 2k in size.

	* configure.in, engine/lib_socket.c, include/il_config.h.in,
	include/il_sysio.h, support/socket.c: fix bugs in the "select"
	implementation; make it bullet-proof against signals; pass
	back more information about which descriptors fired.

2002-05-01 Charlie Carnow  <carnow@gmx.net>

	* support/socket.c, engine/lib_socket.c: Implementation of
	Select

2002-04-30  Rhys Weatherley  <rweather@southern-storm.com.au>

	* codegen/cg_ainit.tc, codegen/cg_misc.tc, codegen/cg_nodes.tc,
	codegen/cg_output.c, codegen/cg_output.h, codegen/jv_misc.tc,
	cscc/csharp/cs_grammar.y, cscc/csharp/cs_misc.tc: semantic
	analysis and code generation for array "new" operator.

	* samples/codepage.cs: add command-line options to assist with
	dumping the contents of code pages.

	* samples/I18N.CJK.dll, samples/I18N.MidEast.dll,
	samples/I18N.Other.dll, samples/I18N.Rare.dll,
	samples/I18N.West.dll, samples/I18N.dll,
	samples/System.Xml.dll, samples/System.dll,
	samples/mscorlib.dll: new versions of the library assemblies.

2002-04-29  Rhys Weatherley  <rweather@southern-storm.com.au>

	* include/il_thread.h, support/no_defs.h, support/pt_defs.c,
	support/pt_defs.h, support/thr_defs.h, support/thread.c,
	support/w32_defs.h, support/wakeup.c: implement thread joins.

	* include/il_thread.h, support/thr_defs.h, support/thread.c:
	implement thread abort handling.

2002-04-28  Rhys Weatherley  <rweather@southern-storm.com.au>

	* engine/ilrun.c, engine/process.c, include/il_engine.h:
	recognise invalid program entry points and refuse to run
	the program if one is supplied.

	* support/pt_defs.c (_ILCondVarTimedWait): mismatch between
	microseconds and nanoseconds.

	* tests/test_thread.c: tests for "ILThreadSleep".

2002-04-27  Rhys Weatherley  <rweather@southern-storm.com.au>

	* support/Makefile.am, support/mutex.c, support/no_defs.c,
	support/no_defs.h, support/pt_defs.c, support/pt_defs.h,
	support/thr_defs.h, support/thread.c, support/w32_defs.c,
	support/w32_defs.h: rearrange the threading code so that
	90% of it is common between platforms.

	* support/w32_defs.h: minor macro bugs in previous check-in.

	* support/pt_include.h, support/pt_mutex.c, support/pt_thread.c,
	support/pt_wait.c, support/w32_include.h, support/w32_mutex.c,
	support/w32_thread.c: remove files that are no longer necessary
	after the rearrangement.

	* image/meta_types.c (ILTypeGetEnumType, ILTypeGetDelegateMethod):
	resolve the class before searching it for fields or methods.

	* samples/System.dll, samples/mscorlib.dll: updated assemblies.

	* include/il_thread.h, support/Makefile.am, support/no_defs.c,
	support/no_defs.h, support/pt_defs.c, support/pt_defs.h,
	support/thr_defs.h, support/thread.c, support/w32_defs.c,
	support/w32_defs.h, support/wakeup.c: implement condition mutexes,
	condition variables, thread wakeup objects, and thread sleeping.

	* support/w32_defs.h: missing definitions for the "_ILCondMutex"
	and "_ILCondVar" types.

2002-04-26  Rhys Weatherley  <rweather@southern-storm.com.au>

	* support/pt_include.h, support/pt_mutex.c, support/pt_thread.c,
	support/pt_wait.c: implement "safe" thread suspends that will not
	suspend a thread that is currently holding a mutex or a rwlock.

	* support/pt_thread.c: clean up the mutexes and semaphores that
	are owned by a thread when it is destroyed.

	* tests/test_thread.c: more thread-related test cases.

2002-04-25  Rhys Weatherley  <rweather@southern-storm.com.au>

	* support/pt_thread.c: fix problems with "resumeRequested" flag.

	* configure.in, include/il_config.h.in: add "usleep" to the set
	of functions that are autoconf'ed.

	* include/il_thread.h, support/README.threads, support/no_thread.c,
	support/pt_thread.c, support/w32_thread.c: implement some more
	thread primitives; unblock the pthreads cancel signal during
	thread suspends; describe what needs to be done to add a new
	thread package.

	* tests/.cvsignore, tests/Makefile.am, tests/test_thread.c:
	add the beginnings of a regression test suite for threading.

	* support/w32_thread.c: missing parameter to "TerminateThread".

	* support/pt_thread.c: set the thread object in a thread-specific
	variable for the main thread.

	* support/w32_thread.c: make sure that the body of "ILThreadInit"
	is only run once.

	* include/il_thread.h, support/no_thread.c, support/pt_thread.c,
	support/w32_thread.c, tests/test_thread.c: bug fixes to threading
	primitives.

	* support/w32_include.h, support/w32_mutex.c, support/w32_thread.c:
	fix bugs in the Win32 threading system that were exposed by the
	test suite; implement "safe" thread suspension that ensures that
	critical sections are not held by suspended Win32 threads.

	* tests/test_thread.c: add tests that check that a thread cannot
	be suspended while it holds a mutex or a read/write lock.

2002-04-24  Rhys Weatherley  <rweather@southern-storm.com.au>

	* include/il_thread.h, support/Makefile.am, support/no_thread.c,
	support/pt_include.h, support/pt_mutex.c, support/pt_thread.c,
	support/pt_wait.c: continue implementing threading primitives.

	* acconfig.h, configure.in, include/il_config.h.in,
	libgc/misc.c, libgc/include/private/gcconfig.h, support/hb_gc.c:
	enable libgc's threading support for Win32/Cygwin.

	* support/Makefile.am, support/no_thread.c, support/pt_include.h,
	support/pt_mutex.c, support/pt_thread.c, support/pt_wait.c,
	support/thr_choose.h, support/w32_mutex.c, support/w32_thread.c:
	begin implementing Win32 thread routines and centralise the
	detection of thread packages into "thr_choose.h".

	* image/Makefile.am, image/meta_types.c, image/misc.c,
	image/misc_token.c, image/types.c, support/Makefile.am,
	support/alloc.c, support/allocate.c, support/convert.c,
	support/cvt_float.c: rename some source files that had duplicate
	names because it was causing breakpoint problems in gdb.

2002-04-23  Rhys Weatherley  <rweather@southern-storm.com.au>

	* engine/HACKING: describe more of the engine architecture.

	* configure.in, include/Makefile.am, include/il_thread.h,
	support/Makefile.am, support/no_thread.c, support/pt_include.h,
	support/pt_thread.c: begin adding threading primitives, based
	on pthreads.

2002-04-22  Rhys Weatherley  <rweather@southern-storm.com.au>

	* codegen/cg_gen.c, codegen/cg_gen.h, cscc/common/cc_main.c:
	never use the ".library" builtin unless the "-fbuiltin-library"
	command-line option is supplied; create AssemblyRef's for all
	libraries that are specified by "-l" options.

	* cscc/csharp/cs_decls.tc: add the "beforefieldinit" flag to
	classes that need it.

	* codegen/cg_gen.c, codegen/cg_gen.h, codegen/cg_output.c,
	cscc/common/cc_errors.c: add security attributes to the output
	image if unsafe constructs are used in the source program.

	* image/meta_build.c (Load_MemberRef): scan up the class
	hierarchy to resolve a member because C# compilers output
	the direct parent class in "base.X" expressions, even if
	"X" lives in an indirect ancestor.

	* csdoc/doc_backend.h, csdoc/doc_main.c, csdoc/doc_valil.c,
	csdoc/status.sh: process multiple "-fimage" options in "csdocvalil".

2002-04-21  Gopal.V  <gopalv82@symonds.net>

	* csdoc/doc_test.c : Test stubber for ECMA classes , added
	csdoc2test to create stub test classes.

2002-04-21  Rhys Weatherley  <rweather@southern-storm.com.au>

	* support/spawn.c (ILSpawnProcess): pass the first few options
	directly on the command-line instead of in the response file.

	* csant/csant_cscc.c (BuildCscCommandLine): pass "/noconfig" in
	addition to "/nostdlib" to csc, because "/nostdlib" only turns
	off mscorlib.dll, and not all standard libraries.

	* samples/I18N.CJK.dll, samples/I18N.MidEast.dll,
	samples/I18N.Other.dll, samples/I18N.Rare.dll,
	samples/I18N.West.dll, samples/I18N.dll,
	samples/Makefile.am, samples/System.Xml.dll,
	samples/System.dll, samples/mscorlib.dll: new versions after
	fixing build problems with System and System.Xml.

2002-04-20  Rhys Weatherley  <rweather@southern-storm.com.au>

	* ChangeLog, doc/ChangeLog-2: move the contents of "ChangeLog" to
	"doc/ChangeLog-2", because it was starting to get too big to manage.

	* engine/cvm.c, engine/cvm_dasm.c: profile "wide" instructions.

	* engine/cvm.h, engine/cvm_dasm.c, engine/cvm_ptr.c, engine/cvmc.c,
	engine/cvmc_obj.c, engine/null_coder.c, engine/verify_var.c,
	include/il_coder.h: introduce the "pread_this" and "iread_this"
	instructions into CVM to optimise the common cases of accessing
	fields relative to "this".

	* engine/cvm.c, engine/cvm_call.c, engine/cvmc.c, engine/ilrun.c,
	engine/method_cache.c, engine/method_cache.h, image/program.h:
	implement method profiling in the engine to get a picture of
	which methods in pnetlib are highly used.
