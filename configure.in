dnl Process this file with autoconf to produce a configure script.
AC_INIT(include/il_opcodes.h)

dnl Determine the build, host, and target system types.
AC_CANONICAL_SYSTEM

dnl Initialize automake.
AM_INIT_AUTOMAKE(pnet, 0.2.5)
AM_CONFIG_HEADER(include/il_config.h)

dnl Checks for programs.
AC_PROG_AWK
AC_PROG_CC
AC_PROG_INSTALL
AC_PROG_LN_S
AC_PROG_MAKE_SET
AC_PROG_RANLIB
AC_PROG_YACC
AM_PROG_LEX
AC_PATH_PROG(TREECC, treecc,, ${prefix}/bin:$PATH)
if test -z "$TREECC" ; then
    echo "treecc is required to build and can be obtained from"
    echo "http://www.southern-storm.com.au"
    exit 1
fi


dnl Checks for libraries.
AC_SUBST(REGEXLIBS)
AC_CHECK_LIB(m, sin)
AC_CHECK_LIB(dl, dlopen)
AC_CHECK_LIB(regex, regcomp, [REGEXLIBS=-lregex], [])

dnl Collect up the libraries that we need for GNU readline.
AC_SUBST(READLINELIBS)
READLINELIBS=""
AC_CHECK_LIB(termcap, tgoto, [READLINELIBS="$READLINELIBS -ltermcap"], [])
AC_CHECK_LIB(readline, readline, [AC_DEFINE(HAVE_LIBREADLINE)
READLINELIBS="-lreadline $READLINELIBS"], [], $READLINELIBS)
AC_CHECK_LIB(history, add_history, [AC_DEFINE(HAVE_LIBHISTORY)
READLINELIBS="-lhistory $READLINELIBS"], [])

dnl Checks for header files.
AC_HEADER_STDC
AC_HEADER_SYS_WAIT
AC_HEADER_TIME
AC_CHECK_HEADERS(string.h strings.h memory.h stdlib.h math.h fcntl.h)
AC_CHECK_HEADERS(stdarg.h varargs.h sys/mman.h unistd.h sys/stat.h)
AC_CHECK_HEADERS(sys/time.h sys/types.h regex.h dlfcn.h)
AC_CHECK_HEADERS(readline/readline.h readline/history.h)

dnl Checks for typedefs, structures, and compiler characteristics.
AC_C_CONST
AC_CHECK_SIZEOF(int, 4)
AC_CHECK_SIZEOF(long, 4)
AC_CHECK_SIZEOF(long long, 8)
AC_CHECK_SIZEOF(float, 4)
AC_CHECK_SIZEOF(double, 8)
AC_CHECK_SIZEOF(long double, 12)
AC_CHECK_SIZEOF(void *, 4)

dnl Check to see if we are using gcc or not.
AM_CONDITIONAL(USINGGCC, test x$GCC = xyes)

dnl Checks for library functions.
AC_FUNC_MEMCMP
AC_CHECK_FUNCS(memset memcmp memchr memcpy memmove bcopy bzero bcmp)
AC_CHECK_FUNCS(isnan isinf finite fmod strtod mmap munmap getpagesize)
AC_CHECK_FUNCS(stat vfprintf waitpid wait fork execv open gettimeofday)
AC_CHECK_FUNCS(getpid qsort regcomp re_comp unlink remove getcwd getwd)
AC_CHECK_FUNCS(get_current_dir_name dlopen)
AC_CHECK_FUNCS(acos asin atan atan2 ceil cos cosh exp floor remainder)
AC_CHECK_FUNCS(log log10 pow rint sin sinh sqrt tan tanh)
AC_FUNC_ALLOCA

dnl Configure libffi and libgc
AC_CONFIG_SUBDIRS(libffi libgc)

AC_OUTPUT([
Makefile
include/Makefile
support/Makefile
image/Makefile
dumpasm/Makefile
engine/Makefile
ilasm/Makefile
ildasm/Makefile
ilalink/Makefile
ilsize/Makefile
ilnative/Makefile
ilfind/Makefile
ildiff/Makefile
codegen/Makefile
cscc/Makefile
resgen/Makefile
ildb/Makefile
csdoc/Makefile
csant/Makefile
samples/Makefile
doc/Makefile])
